# 2.电源管理
## 电压域
电压域指使用同一个电压源的模块合集，如果几个模块使用相同的电压源，就认为这几个模块属于同一个电压域。
![vdomian](vx_images/481545816586188.png)
不同电压域之间存在异步桥模块，异步桥的核心处理逻辑和核心时钟域在VCPU电压域内。DSU的异步桥时钟域在VSYS电压域内。
## 电源域
电源域指的是在同一个电压域内，共享相同电源开关逻辑的模块合集。即在同一个电源域的模块被相同的电源开关逻辑控制，
同时上、下电。一个电压域内的模块，可以根据设计需求，拆分到不同电源域。
![pdomain](vx_images/349621616132666.png)
DSU集群包含多个core，电源域如下图
![dsupdomain](vx_images/261851464947010.png)
每个core的高级SIMD和浮点运算拥有独立的电源域。
## 时钟门控架构模式
a55 core如果进入standby模式，它的时钟门控处于时钟树顶层。
Wait for Interrupt (WFI) and Wait for Event (WFE)是armv8a架构Feature，功能是关闭顶层时钟树使core进入standby模式，
standby模式下core会完整保留所有状态。ARM建议在WFI/WFE之前使用一条DSB指令来确保挂起的memory事务在改变状态前完成。

**描述**：在standby操作模式下，core仍处于通电状态，但它的大多数时钟都停止了，或时钟门控。这意味着，core的几乎所有部分都处于静止状态，但是还留有少量逻辑的时钟和电流，它们用于唤醒core。
各种形式的动态时钟门控也可以在硬件上实现。例如，SCU、GIC、计时器、指令管道或NEON块可以在检测到空闲状态时自动进行时钟门控，以节省功耗。  

**进入**：core执行WFI/WFE指令进入standby模式。ARM建议在WFI/WFE之前使用一条DSB指令来确保挂起的memory事务在改变状态前完成。  

**唤醒条件**：在调试状态下，core是活动状态的。对于WFI，一个中断或外部调试请求可以唤醒core。对于WFE，存在许多指定的事件，包括cluster中另一个正在执行SEV指令的core。  

来自Snoop控制单元(SCU)的请求可以为多核系统中的缓存一致性操作唤醒core的时钟，但是不会唤醒core。这意味着处于待机状态的core的缓存将继续与其他core的缓存保持一致(但处于待机状态的核心不需要执行下一条指令)。另外就是debug操作时也会唤醒core时钟。

core的复位总是强制core退出待机状态。

standby模式进入和退出时延非常快，通常只需要两个cycle。因此团队内核的延迟和响应几乎没有影响。